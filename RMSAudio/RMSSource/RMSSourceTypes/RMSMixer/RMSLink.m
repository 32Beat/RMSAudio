////////////////////////////////////////////////////////////////////////////////
/*
	RMSLink
	
	Created by 32BT on 15/11/15.
	Copyright Â© 2015 32BT. All rights reserved.
*/
////////////////////////////////////////////////////////////////////////////////


#import "RMSLink.h"
#import "RMSUtilities.h"
#import "RMSAudio.h"

////////////////////////////////////////////////////////////////////////////////
@implementation RMSLink
////////////////////////////////////////////////////////////////////////////////

static OSStatus renderCallback(void *rmsObject, const RMSCallbackInfo *infoPtr)
{
	OSStatus result = noErr;
	
	void *source = RMSSourceGetSource(rmsObject);
	if (source != nil)
	{ result = RunRMSSource(source, infoPtr); }
	
	return result;
}

////////////////////////////////////////////////////////////////////////////////

+ (const RMSCallbackProcPtr) callbackProcPtr
{ return renderCallback; }

////////////////////////////////////////////////////////////////////////////////
#pragma mark
////////////////////////////////////////////////////////////////////////////////

void *RMSLinkGetLink(void *source)
{ return (__bridge void *)((__bridge RMSLink *)source)->mLink; }

////////////////////////////////////////////////////////////////////////////////
#pragma mark
////////////////////////////////////////////////////////////////////////////////

- (RMSLink *) link
{ return mLink; }

////////////////////////////////////////////////////////////////////////////////

- (void) setLink:(RMSLink *)link
{
	if (mLink != link)
	{
		id oldLink = mLink;
		
		mLink = link;

		[self trashObject:oldLink];
	}
}

////////////////////////////////////////////////////////////////////////////////

- (void) addLink:(RMSLink *)link
{
	if (mLink == nil)
	{ [self setLink:link]; }
	else
	{ [mLink addLink:link]; }
}

////////////////////////////////////////////////////////////////////////////////

- (void) removeLink:(RMSLink *)link
{
	if (mLink == link)
	{ [self removeLink]; }
	else
	{ [mLink removeLink:link]; }
}

////////////////////////////////////////////////////////////////////////////////

- (void) removeLink
{
	if (mLink != nil)
	{ [self setLink:[mLink link]]; }
}

////////////////////////////////////////////////////////////////////////////////
#pragma mark
////////////////////////////////////////////////////////////////////////////////

- (void) setSampleRate:(Float64)sampleRate
{
	[super setSampleRate:sampleRate];
	[mLink setSampleRate:sampleRate];
}

////////////////////////////////////////////////////////////////////////////////
@end
////////////////////////////////////////////////////////////////////////////////
